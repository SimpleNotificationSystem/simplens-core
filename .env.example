# ============================================
# API SERVER
# ============================================
NS_API_KEY=                        # Generate via: openssl rand -base64 32
PORT=3000                          # API server port
MAX_BATCH_REQ_LIMIT=1000           # Max batch request size

# ============================================
# DATABASE
# ============================================
MONGO_URI=                         # MongoDB connection string (skip if using docker-compose)

# ============================================
# KAFKA
# ============================================
BROKERS=localhost:9092             # Kafka brokers list (skip if using docker-compose)

# Kafka Topic Partitions (Core Topics)
DELAYED_PARTITION=1                # Partitions for delayed_notification topic
NOTIFICATION_STATUS_PARTITION=1    # Partitions for notification_status topic


# ============================================
# REDIS
# ============================================
REDIS_URL=redis://localhost:6379   # Redis connection URL (skip if using docker-compose)

# ============================================
# PLUGIN SYSTEM
# ============================================
SIMPLENS_CONFIG_PATH=./simplens.config.yaml   # Path to plugin configuration file
PROCESSOR_CHANNEL=all                          # 'all' for all channels, or specific: 'email', 'sms'


# ============================================
# BACKGROUND WORKER
# ============================================
WORKER_ID=                         # Unique worker ID (auto-generated if not set)
OUTBOX_POLL_INTERVAL_MS=5000       # Poll every 5 seconds
OUTBOX_CLEANUP_INTERVAL_MS=60000   # Cleanup every 60 seconds
OUTBOX_BATCH_SIZE=100              # Process 100 entries per poll
OUTBOX_RETENTION_MS=300000         # Keep published entries for 5 minutes
OUTBOX_CLAIM_TIMEOUT_MS=30000      # Claim timeout for crashed workers

# ============================================
# RETRY & IDEMPOTENCY
# ============================================
IDEMPOTENCY_TTL_SECONDS=86400      # Keep idempotency keys for 24 hours
MAX_RETRY_COUNT=5                  # Max retries before marking as failed
PROCESSING_TTL_SECONDS=120         # Processing lock held for 2 minutes

# ============================================
# DELAYED NOTIFICATIONS
# ============================================
DELAYED_POLL_INTERVAL_MS=1000      # Poll Redis every 1 second
DELAYED_BATCH_SIZE=10              # Fetch 10 due events per poll
MAX_POLLER_RETRIES=3               # Max retries before DLQ

# ============================================
# RECOVERY SERVICE
# ============================================
RECOVERY_POLL_INTERVAL_MS=60000            # Run recovery every 1 minute
PROCESSING_STUCK_THRESHOLD_MS=300000       # Mark as stuck after 5 minutes
PENDING_STUCK_THRESHOLD_MS=300000          # Mark as orphaned after 5 minutes
RECOVERY_BATCH_SIZE=50                     # Process 50 stuck notifications per poll

# ============================================
# CLEANUP (runs as part of recovery)
# ============================================
CLEANUP_RESOLVED_ALERTS_RETENTION_MS=86400000             # Keep resolved alerts for 24 hours
CLEANUP_PROCESSED_STATUS_OUTBOX_RETENTION_MS=86400000     # Keep processed status outbox for 24 hours

# ============================================
# LOGGING (Grafana/Loki)
# ============================================
LOKI_URL=http://localhost:3100     # Loki URL for log aggregation
LOG_LEVEL=info                     # Log level: debug, info, warn, error
LOG_TO_FILE=true                   # Enable file logging

# ============================================
# ADMIN DASHBOARD
# ============================================
AUTH_SECRET=                       # Generate via: openssl rand -base64 32
ADMIN_USERNAME=admin               # Dashboard admin username
ADMIN_PASSWORD=                    # Dashboard admin password
AUTH_TRUST_HOST=true               # Trust host for auth
API_BASE_URL=http://localhost:3000 # Notification service API URL
WEBHOOK_HOST=localhost             # Webhook host for callbacks
WEBHOOK_PORT=3002                  # Dashboard webhook port
DASHBOARD_PORT=3002                # Dashboard port

# ============================================
# PLUGIN SPECIFIC ENV VARIABLES (Partition variables + Plugin credentials)
# ============================================

# Channel-Specific Partitions (Dynamic - based on simplens.config.yaml channels)
# Topic: {CHANNEL}_notification, Env: {CHANNEL}_PARTITION
MOCK_PARTITION=1                  # Partitions for mock_notification topic

# PLUGIN CREDENTIALS (@simplens/nodemailer-gmail) (You need to install this plugin seperately. Not included with simplens-core)
EMAIL_HOST=smtp.gmail.com          # SMTP host
EMAIL_PORT=587                     # SMTP port (587 for TLS, 465 for SSL)
EMAIL_USER=                        # Gmail address
EMAIL_PASS=                        # Gmail app password (not regular password!)
EMAIL_FROM=                        # From address (defaults to EMAIL_USER)